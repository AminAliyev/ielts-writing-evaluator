{% extends "base.html" %}
{% block title %}Processing - IELTS Writing{% endblock %}
{% block content %}
<div class="max-w-3xl mx-auto px-4 py-16">
    <div class="bg-white border p-8 text-center">
        <div id="loading">
            <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto"></div>
            <h2 class="mt-6 text-2xl font-bold">Evaluating Your Essay</h2>
            <p class="mt-2 text-gray-600">This usually takes 10-30 seconds</p>
        </div>
        <div id="error" class="hidden">
            <h2 class="text-2xl font-bold text-red-600">Evaluation Failed</h2>
            <p class="mt-2" id="err-msg"></p>
            <button onclick="retry()" class="mt-6 bg-blue-600 text-white px-6 py-3 rounded">Retry</button>
        </div>
    </div>
</div>
<script>
const id='{{attempt.id}}';
function check(){fetch('/api/attempts/'+id+'/status/').then(r=>r.json()).then(d=>{if(d.status=='DONE'&&d.redirect_url)window.location.href=d.redirect_url;else if(d.status=='FAILED'){document.getElementById('loading').classList.add('hidden');document.getElementById('error').classList.remove('hidden');document.getElementById('err-msg').textContent=d.error_message||'Failed'}})}
function retry(){fetch('/api/attempts/'+id+'/retry/',{method:'POST',headers:{'X-CSRFToken':'{{csrf_token}}'}}).then(r=>r.json()).then(()=>location.reload())}
check();setInterval(check,2000);
</script>
{% endblock %}
